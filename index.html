<!DOCTYPE html>
<html lang="id" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ISSI Screener â€” Saham Syariah IDX</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* â”€â”€ TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root{
  --bg:#f8f9fb;--surface:#ffffff;--surface2:#f1f3f6;--border:#e2e5eb;--border2:#c9cdd6;
  --text:#0f1117;--text2:#404755;--text3:#8891a0;
  --accent:#2563eb;--accent-bg:#eff6ff;--accent-h:#1d4ed8;
  --green:#16a34a;--green-bg:#f0fdf4;--green-dim:#dcfce7;
  --red:#dc2626;--red-bg:#fff5f5;--red-dim:#fee2e2;
  --amber:#d97706;--amber-bg:#fffbeb;
  --blue:#2563eb;--blue-bg:#eff6ff;--blue-dim:#dbeafe;
  --purple:#7c3aed;--purple-bg:#f5f3ff;--purple-dim:#ede9fe;
  --shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --shadow-md:0 4px 6px rgba(0,0,0,.05),0 2px 4px rgba(0,0,0,.04);
  --font:'Inter',system-ui,sans-serif;
  --mono:'JetBrains Mono','Fira Mono',monospace;
  --r:8px;--rs:5px;
}
[data-theme="dark"]{
  --bg:#0d0f14;--surface:#161920;--surface2:#1e2028;--border:#272b36;--border2:#363c4a;
  --text:#edf0f7;--text2:#9aa4b8;--text3:#4e5669;
  --accent:#3b82f6;--accent-bg:#172035;--accent-h:#60a5fa;
  --green:#22c55e;--green-bg:#0a1f12;--green-dim:#14532d;
  --red:#f87171;--red-bg:#1c0a0a;--red-dim:#450a0a;
  --amber:#fbbf24;--amber-bg:#1c1404;
  --blue:#60a5fa;--blue-bg:#172035;--blue-dim:#1e3a5f;
  --purple:#a78bfa;--purple-bg:#1d1535;--purple-dim:#2e1f5e;
  --shadow:0 1px 3px rgba(0,0,0,.3),0 1px 2px rgba(0,0,0,.2);
  --shadow-md:0 4px 6px rgba(0,0,0,.3),0 2px 4px rgba(0,0,0,.2);
}

/* â”€â”€ RESET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:14px;-webkit-text-size-adjust:100%}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh;line-height:1.5;transition:background .2s,color .2s}

/* â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar{
  background:var(--surface);border-bottom:1px solid var(--border);
  padding:0 1rem;display:flex;align-items:center;height:52px;
  position:sticky;top:0;z-index:200;box-shadow:var(--shadow);gap:.6rem;
}
.brand{display:flex;align-items:center;gap:.4rem;font-weight:700;font-size:.92rem;flex-shrink:0;letter-spacing:-.01em}
.brand-ico{width:28px;height:28px;background:linear-gradient(135deg,var(--accent),#1d4ed8);border-radius:var(--rs);display:grid;place-items:center;font-size:.6rem;font-weight:700;color:#fff;letter-spacing:.04em;box-shadow:0 2px 6px rgba(37,99,235,.35)}
.topbar-meta{display:flex;align-items:center;gap:.9rem;font-size:.73rem;color:var(--text3);flex:1;min-width:0;overflow:hidden}
.meta-item{display:flex;align-items:center;gap:.28rem;white-space:nowrap}
.dot{width:6px;height:6px;border-radius:50%;background:var(--text3);flex-shrink:0}
.dot.ok{background:var(--green)}.dot.spin{background:var(--accent);animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.topbar-right{display:flex;align-items:center;gap:.4rem;margin-left:auto;flex-shrink:0}
.btn-icon{display:flex;align-items:center;gap:.28rem;padding:.3rem .6rem;border-radius:var(--rs);border:1px solid var(--border);background:var(--surface);color:var(--text2);font-family:var(--font);font-size:.73rem;cursor:pointer;transition:all .15s;font-weight:500;white-space:nowrap;line-height:1}
.btn-icon:hover{background:var(--surface2);border-color:var(--border2);color:var(--text)}
.btn-icon.active{background:var(--surface2);border-color:var(--border2)}

/* â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.progress-bar{height:2px;background:var(--border);position:sticky;top:52px;z-index:199}
.progress-fill{height:100%;background:var(--accent);width:0;transition:width .25s ease}

/* â”€â”€ PAGE LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page{max-width:1680px;margin:0 auto;padding:1rem}

/* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);margin-bottom:.75rem;overflow:hidden}
.card-body{padding:.75rem 1rem}

/* â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.search-wrap{position:relative;display:flex;align-items:center}
.search-icon{position:absolute;left:.75rem;color:var(--text3);pointer-events:none;display:flex}
.search-inp{
  width:100%;padding:.55rem .75rem .55rem 2.1rem;
  border:1px solid var(--border);border-radius:var(--rs);
  background:var(--surface);color:var(--text);
  font-family:var(--font);font-size:.875rem;outline:none;
  transition:border-color .15s,box-shadow .15s;
  padding-right:2.2rem;
}
.search-inp::placeholder{color:var(--text3)}
.search-inp:focus{border-color:var(--accent);box-shadow:0 0 0 3px color-mix(in srgb,var(--accent) 12%,transparent)}
.search-clear{
  position:absolute;right:.6rem;color:var(--text3);background:none;border:none;
  cursor:pointer;display:none;align-items:center;justify-content:center;
  width:18px;height:18px;border-radius:50%;transition:all .15s;padding:0;
}
.search-clear:hover{background:var(--surface2);color:var(--text)}
.search-clear.show{display:flex}

/* â”€â”€ FILTER PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.filter-grid{display:grid;grid-template-columns:1fr 1fr;gap:0;border-bottom:1px solid var(--border)}
.filter-grid:last-child{border-bottom:none}
@media(max-width:700px){.filter-grid{grid-template-columns:1fr}}
.f-block{padding:.65rem 1rem;border-right:1px solid var(--border)}
.f-block:last-child{border-right:none}
@media(max-width:700px){.f-block{border-right:none;border-bottom:1px solid var(--border)}}
.f-label{font-size:.62rem;font-weight:700;letter-spacing:.1em;color:var(--text3);text-transform:uppercase;display:flex;align-items:center;gap:.28rem;margin-bottom:.45rem}
.f-label::before{content:'';width:3px;height:9px;border-radius:2px;display:inline-block;flex-shrink:0}
.f-label.ma::before{background:var(--green)}
.f-label.vol::before{background:var(--blue)}
.f-label.osc::before{background:var(--purple)}
.chips{display:flex;flex-wrap:wrap;gap:.28rem;align-items:center}
.chip{
  padding:.2rem .5rem;border-radius:20px;border:1px solid var(--border);
  background:var(--surface);color:var(--text2);
  font-family:var(--font);font-size:.7rem;cursor:pointer;
  transition:all .15s;font-weight:500;user-select:none;line-height:1.4;
}
.chip:hover{border-color:currentColor}
.chip.ma:hover,.chip.ma.on{border-color:var(--green);color:var(--green);background:var(--green-bg)}
.chip.ma.on{font-weight:600}
.chip.vol:hover,.chip.vol.on{border-color:var(--blue);color:var(--blue);background:var(--blue-bg)}
.chip.vol.on{font-weight:600}
.chip.osc:hover,.chip.osc.on{border-color:var(--purple);color:var(--purple);background:var(--purple-bg)}
.chip.osc.on{font-weight:600}
.chip.reset{color:var(--text3);font-size:.66rem}
.chip.reset:hover{color:var(--text);border-color:var(--border2);background:var(--surface2)}

/* â”€â”€ STATS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-bar{
  display:flex;align-items:center;gap:1rem;
  padding:.45rem 1rem;border-bottom:1px solid var(--border);
  font-size:.72rem;color:var(--text3);flex-wrap:wrap;
}
.stat{display:flex;align-items:center;gap:.28rem}
.stat strong{color:var(--text);font-weight:600}
.stat.g strong{color:var(--green)}
.stat.r strong{color:var(--red)}
.stat.b strong{color:var(--accent)}
.src-tag{margin-left:auto;display:inline-flex;align-items:center;gap:.25rem;padding:.15rem .5rem;border-radius:20px;font-size:.65rem;font-weight:600;border:1px solid transparent}
.src-tag.gh{background:var(--green-dim);color:var(--green);border-color:color-mix(in srgb,var(--green) 25%,transparent)}
.src-tag.cache{background:var(--blue-dim);color:var(--blue);border-color:color-mix(in srgb,var(--blue) 25%,transparent)}

/* â”€â”€ DEBUG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.debug-bar{background:var(--surface2);border:1px solid var(--border);border-radius:var(--rs);padding:.55rem .85rem;margin-bottom:.75rem;font-family:var(--mono);font-size:.65rem;color:var(--text2);max-height:110px;overflow-y:auto;display:none}
.debug-bar.show{display:block}
.dline{padding:1px 0}.dline.ok{color:var(--green)}.dline.err{color:var(--red)}.dline.warn{color:var(--amber)}

/* â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.t-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}
table{width:100%;border-collapse:collapse;font-size:.76rem}

/* Group header row */
tr.grp-row th{
  padding:.22rem .6rem;font-size:.6rem;font-weight:700;letter-spacing:.08em;
  text-transform:uppercase;color:var(--text3);background:var(--surface2);
  cursor:default;white-space:nowrap;border-bottom:1px solid var(--border);
}
tr.grp-row th:first-child{padding-left:1rem}
.gh-price{border-left:3px solid var(--accent);color:var(--accent)}
.gh-ma{border-left:3px solid var(--green);color:var(--green)}
.gh-vol{border-left:3px solid var(--blue);color:var(--blue)}
.gh-osc{border-left:3px solid var(--purple);color:var(--purple)}

/* Main header row */
tr.col-row th{
  padding:.45rem .6rem;font-size:.68rem;font-weight:600;letter-spacing:.02em;
  color:var(--text2);background:var(--surface2);white-space:nowrap;
  cursor:pointer;user-select:none;
  border-bottom:2px solid var(--border);
  transition:color .15s;text-align:right;
}
tr.col-row th:first-child,tr.col-row th:nth-child(2){text-align:left}
tr.col-row th:first-child{padding-left:1rem}
tr.col-row th:hover{color:var(--text)}
tr.col-row th.nc{cursor:default}
tr.col-row th.nc:hover{color:var(--text2)}
tr.col-row th.sa::after{content:' â†‘';color:var(--accent);font-size:.6rem}
tr.col-row th.sd::after{content:' â†“';color:var(--accent);font-size:.6rem}
.ch-price{border-left:3px solid color-mix(in srgb,var(--accent) 35%,transparent)}
.ch-ma{border-left:3px solid color-mix(in srgb,var(--green) 35%,transparent)}
.ch-vol{border-left:3px solid color-mix(in srgb,var(--blue) 35%,transparent)}
.ch-osc{border-left:3px solid color-mix(in srgb,var(--purple) 35%,transparent)}

/* Body rows */
tbody tr{border-bottom:1px solid var(--border);transition:background .1s}
tbody tr:hover{background:var(--surface2)}
tbody tr:last-child{border-bottom:none}
tbody td{padding:.45rem .6rem;white-space:nowrap;vertical-align:middle;text-align:right}
tbody td:first-child,tbody td:nth-child(2){text-align:left}
tbody td:first-child{padding-left:1rem}
.bd-price{border-left:3px solid color-mix(in srgb,var(--accent) 15%,transparent)}
.bd-ma{border-left:3px solid color-mix(in srgb,var(--green) 15%,transparent)}
.bd-vol{border-left:3px solid color-mix(in srgb,var(--blue) 15%,transparent)}
.bd-osc{border-left:3px solid color-mix(in srgb,var(--purple) 15%,transparent)}

/* Cell types */
.c-no{color:var(--text3);font-size:.66rem;min-width:24px}
.c-tk{font-family:var(--mono);font-weight:600;font-size:.78rem;line-height:1.2}
.c-tk a{color:var(--accent);text-decoration:none;transition:color .12s}
.c-tk a:hover{color:var(--accent-h);text-decoration:underline}
.c-co{font-size:.68rem;color:var(--text3);max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:1.3;margin-top:.5px}
.c-num{font-family:var(--mono);font-weight:500}
.c-num.lg{font-weight:600;font-size:.79rem}
.up{color:var(--green)}.dn{color:var(--red)}.nu{color:var(--text3)}

/* Pip clusters */
.pips{display:flex;gap:2px;justify-content:flex-end}
.pip{
  width:20px;height:18px;border-radius:3px;
  font-size:.54rem;font-weight:700;display:grid;place-items:center;
  font-family:var(--mono);cursor:default;line-height:1;
}
.pip.on-g{background:var(--green-dim);color:var(--green)}
.pip.off-r{background:var(--red-dim);color:var(--red)}
.pip.on-b{background:var(--blue-dim);color:var(--blue)}
.pip.na{background:var(--surface2);color:var(--text3)}

/* Gauge */
.gauge{display:flex;align-items:center;gap:.3rem;justify-content:flex-end}
.g-track{width:36px;height:3px;background:var(--surface2);border-radius:2px;overflow:hidden;flex-shrink:0}
.g-fill{height:100%;border-radius:2px}
.g-val{font-family:var(--mono);font-size:.69rem;font-weight:500;min-width:2.8rem;text-align:right}

/* MACD badge */
.macd-badge{display:inline-flex;align-items:center;gap:.25rem;padding:.18rem .45rem;border-radius:20px;font-size:.65rem;font-weight:700;font-family:var(--mono)}
.macd-bull{background:var(--green-dim);color:var(--green)}
.macd-bear{background:var(--red-dim);color:var(--red)}
.macd-neu{background:var(--surface2);color:var(--text3)}

/* ADR cell */
.adr-wrap{display:flex;flex-direction:column;align-items:flex-end;gap:1px}
.adr-pct{font-family:var(--mono);font-size:.71rem;font-weight:600}
.adr-nom{font-family:var(--mono);font-size:.62rem;color:var(--text3)}

/* Empty state */
.t-empty{padding:3rem 1rem;text-align:center;color:var(--text3);font-size:.82rem}
.t-empty .ico{font-size:2rem;margin-bottom:.5rem;opacity:.5}

/* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toasts{position:fixed;bottom:1.25rem;right:1.25rem;display:flex;flex-direction:column;gap:.3rem;z-index:999;pointer-events:none}
.toast{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:.48rem .8rem;font-size:.74rem;color:var(--text);box-shadow:var(--shadow-md);transform:translateX(120%);transition:transform .28s cubic-bezier(.4,0,.2,1);max-width:260px;pointer-events:auto}
.toast.show{transform:translateX(0)}
.toast.ok{border-left:3px solid var(--green)}.toast.er{border-left:3px solid var(--red)}.toast.in{border-left:3px solid var(--accent)}

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:960px){
  .topbar-meta{display:none}
  .page{padding:.75rem .6rem}
  .filter-grid{grid-template-columns:1fr}
  .f-block{border-right:none;border-bottom:1px solid var(--border)}
  .f-block:last-child{border-bottom:none}
}
@media(max-width:600px){
  html{font-size:13px}
  .topbar{padding:0 .75rem}
  .brand span{display:none}
  .btn-icon span{display:none}
}
</style>
</head>
<body>

<!-- â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="topbar">
  <div class="brand">
    <div class="brand-ico">IDX</div>
    <span>ISSI Screener</span>
  </div>
  <div class="topbar-meta">
    <div class="meta-item"><span class="dot" id="sDot"></span><span id="sText">Memuat data...</span></div>
    <div class="meta-item" id="tsWrap" style="display:none"><span>ğŸ•</span><span id="tsText">â€”</span></div>
    <div class="meta-item" id="srcWrap" style="display:none"><span id="srcBadge"></span></div>
  </div>
  <div class="topbar-right">
    <button class="btn-icon active" id="dbBtn" onclick="toggleDebug()">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
      <span>Debug</span>
    </button>
    <button class="btn-icon" onclick="toggleDark()">
      <span id="dkIco">ğŸŒ™</span><span id="dkLbl">Dark</span>
    </button>
  </div>
</header>
<div class="progress-bar"><div class="progress-fill" id="prog"></div></div>

<!-- â”€â”€ PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page">
  <div class="debug-bar" id="dbPanel"><div id="dbLog"></div></div>

  <!-- Search -->
  <div class="card"><div class="card-body">
    <div class="search-wrap">
      <svg class="search-icon" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input class="search-inp" id="sInp" placeholder="Cari ticker atau nama perusahaan..." autocomplete="off" spellcheck="false">
      <button class="search-clear" id="sClear" onclick="clearSearch()" title="Hapus pencarian">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6 6 18M6 6l12 12"/></svg>
      </button>
    </div>
  </div></div>

  <!-- Filters -->
  <div class="card">
    <div class="filter-grid">
      <!-- MA -->
      <div class="f-block">
        <div class="f-label ma">Moving Average â€” harga di atas</div>
        <div class="chips">
          <span class="chip ma" id="mf-ema3"   onclick="toggleMF('ema3')">EMA 3</span>
          <span class="chip ma" id="mf-ema5"   onclick="toggleMF('ema5')">EMA 5</span>
          <span class="chip ma" id="mf-ema10"  onclick="toggleMF('ema10')">EMA 10</span>
          <span class="chip ma" id="mf-ema20"  onclick="toggleMF('ema20')">EMA 20</span>
          <span class="chip ma" id="mf-sma50"  onclick="toggleMF('sma50')">SMA 50</span>
          <span class="chip ma" id="mf-sma100" onclick="toggleMF('sma100')">SMA 100</span>
          <span class="chip ma" id="mf-sma200" onclick="toggleMF('sma200')">SMA 200</span>
          <span class="chip reset" onclick="resetMF()">âœ• Reset</span>
        </div>
      </div>
      <!-- VOL -->
      <div class="f-block">
        <div class="f-label vol">Volume MA â€” volume di atas</div>
        <div class="chips">
          <span class="chip vol" id="vf-vma3"  onclick="toggleVF('vma3')">VMA 3</span>
          <span class="chip vol" id="vf-vma5"  onclick="toggleVF('vma5')">VMA 5</span>
          <span class="chip vol" id="vf-vma20" onclick="toggleVF('vma20')">VMA 20</span>
          <span class="chip vol" id="vf-vma50" onclick="toggleVF('vma50')">VMA 50</span>
          <span class="chip reset" onclick="resetVF()">âœ• Reset</span>
        </div>
      </div>
    </div>
    <div class="filter-grid" style="border-bottom:none">
      <!-- OSC -->
      <div class="f-block" style="border-bottom:none">
        <div class="f-label osc">Oscillator</div>
        <div class="chips">
          <span class="chip osc" id="of-rsi-ob"  onclick="toggleOF('rsi-ob')">RSI &gt;70 (OB)</span>
          <span class="chip osc" id="of-rsi-os"  onclick="toggleOF('rsi-os')">RSI &lt;30 (OS)</span>
          <span class="chip osc" id="of-rsi-bull" onclick="toggleOF('rsi-bull')">RSI &gt;50</span>
          <span class="chip osc" id="of-srsi-ob" onclick="toggleOF('srsi-ob')">StochRSI &gt;80</span>
          <span class="chip osc" id="of-srsi-os" onclick="toggleOF('srsi-os')">StochRSI &lt;20</span>
          <span class="chip osc" id="of-macd-bull" onclick="toggleOF('macd-bull')">MACD Bullish</span>
          <span class="chip osc" id="of-macd-bear" onclick="toggleOF('macd-bear')">MACD Bearish</span>
          <span class="chip reset" onclick="resetOF()">âœ• Reset</span>
        </div>
      </div>
      <div class="f-block" style="border-bottom:none"></div>
    </div>
  </div>

  <!-- Table -->
  <div class="card">
    <div class="stats-bar" id="statsBar" style="display:none">
      <span class="stat">Tampil: <strong id="s-sho">0</strong></span>
      <span class="stat">Total: <strong id="s-tot">0</strong></span>
      <span class="stat g">Bullish: <strong id="s-bul">0</strong></span>
      <span class="stat r">Bearish: <strong id="s-bea">0</strong></span>
      <span class="stat b">â†‘ EMA4: <strong id="s-abo">0</strong></span>
      <span class="src-tag" id="s-src" style="display:none"></span>
    </div>
    <div class="t-scroll">
      <table>
        <thead>
          <tr class="grp-row">
            <th colspan="2"></th>
            <th colspan="3" class="gh-price">HARGA</th>
            <th colspan="2" class="gh-ma">MOVING AVERAGE</th>
            <th colspan="2" class="gh-vol">VOLUME</th>
            <th colspan="5" class="gh-osc">OSCILLATOR</th>
          </tr>
          <tr class="col-row">
            <th class="nc c-no">NO</th>
            <th class="nc" style="min-width:130px">TICKER</th>
            <th onclick="sortBy('price')" class="ch-price">HARGA</th>
            <th onclick="sortBy('pct')" class="ch-price">% CHG</th>
            <th onclick="sortBy('pct1today')" class="ch-price">1% TRX</th>
            <th class="nc ch-ma" title="EMA3 EMA5 EMA10 EMA20 SMA50 SMA100 SMA200">MA (7)</th>
            <th onclick="sortBy('bull')" class="ch-ma">BULL/BEAR</th>
            <th class="nc ch-vol" title="Vol vs VMA3 VMA5 VMA20 VMA50">VMA (4)</th>
            <th onclick="sortBy('lastValue')" class="ch-vol">NILAI TRX</th>
            <th onclick="sortBy('rsi')" class="ch-osc">RSI</th>
            <th onclick="sortBy('stochRsi')" class="ch-osc">StochRSI</th>
            <th onclick="sortBy('macdHist')" class="ch-osc">MACD</th>
            <th onclick="sortBy('atrV')" class="ch-osc">ATR</th>
            <th onclick="sortBy('adrPct')" class="ch-osc">ADR</th>
          </tr>
        </thead>
        <tbody id="tBody">
          <tr><td colspan="14">
            <div class="t-empty">
              <div class="ico">ğŸ“Š</div>
              Memuat data dari repositoryâ€¦<br>
              <small style="font-size:.7rem;color:var(--text3)">Update otomatis setiap hari kerja 09:00, 12:00 &amp; 17:30 WIB</small>
            </div>
          </td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <p style="font-size:.64rem;color:var(--text3);text-align:center;padding-bottom:1.5rem">
    Data dari Yahoo Finance via GitHub Actions Â· Bukan rekomendasi investasi
  </p>
</div>
<div class="toasts" id="toasts"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG & CONSTANTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DATA_URL = 'data/issi_data.json';
const SK = 'issi_v5', SKT = 'issi_v5_ts';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let AD=[], DD=[];
let maF=new Set(), volF=new Set(), oscF=new Set();
let sCol='pct', sDir=-1, dbOn=false;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DARK MODE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function(){
  const t=localStorage.getItem('issi_theme')||'light';
  document.documentElement.setAttribute('data-theme',t);
  _updDk(t);
})();
function toggleDark(){
  const n=document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme',n);
  localStorage.setItem('issi_theme',n);
  _updDk(n);
}
function _updDk(t){
  document.getElementById('dkIco').textContent=t==='dark'?'â˜€ï¸':'ğŸŒ™';
  document.getElementById('dkLbl').textContent=t==='dark'?'Light':'Dark';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DEBUG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _dbLines=[];
function dLog(m,t=''){
  _dbLines.push({m,t});
  if(_dbLines.length>60)_dbLines.shift();
  if(!dbOn)return;
  const el=document.getElementById('dbLog');
  el.innerHTML=_dbLines.slice(-25).map(l=>`<div class="dline ${l.t}">${l.m}</div>`).join('');
  el.scrollTop=el.scrollHeight;
}
function toggleDebug(){
  dbOn=!dbOn;
  document.getElementById('dbPanel').classList.toggle('show',dbOn);
  document.getElementById('dbBtn').classList.toggle('active',dbOn);
  if(dbOn){
    const el=document.getElementById('dbLog');
    el.innerHTML=_dbLines.slice(-25).map(l=>`<div class="dline ${l.t}">${l.m}</div>`).join('');
    el.scrollTop=el.scrollHeight;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MATH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function _ema(a,p){
  if(!a||a.length<p)return null;
  const k=2/(p+1);
  let v=a.slice(0,p).reduce((x,y)=>x+y,0)/p;
  for(let i=p;i<a.length;i++)v=a[i]*k+v*(1-k);
  return v;
}
function _sma(a,p){
  if(!a||a.length<p)return null;
  return a.slice(-p).reduce((x,y)=>x+y,0)/p;
}
function _rsi(a){
  if(!a||a.length<15)return null;
  const s=a.slice(-15);let g=0,l=0;
  for(let i=1;i<s.length;i++){const d=s[i]-s[i-1];if(d>0)g+=d;else l-=d}
  const ag=g/14,al=l/14;
  if(al===0)return 100;
  return 100-100/(1+ag/al);
}
function _stochRSI(a){
  if(!a||a.length<33)return null;
  const ra=[];
  for(let i=15;i<=a.length;i++){
    const s=a.slice(0,i).slice(-15);let g=0,l=0;
    for(let j=1;j<s.length;j++){const d=s[j]-s[j-1];if(d>0)g+=d;else l-=d}
    const ag=g/14,al=l/14;ra.push(al===0?100:100-100/(1+ag/al));
  }
  if(ra.length<14)return null;
  const rec=ra.slice(-14),mn=Math.min(...rec),mx=Math.max(...rec);
  if(mx===mn)return 50;
  return((ra[ra.length-1]-mn)/(mx-mn))*100;
}
function _macd(a){
  // MACD(12,26,9): returns {line, signal, hist, bull}
  if(!a||a.length<35)return null;
  const e12=_ema(a,12), e26=_ema(a,26);
  if(e12===null||e26===null)return null;
  // Compute rolling MACD line for signal
  const lines=[];
  for(let i=26;i<=a.length;i++){
    const sl=a.slice(0,i);
    const m12=_ema(sl,12), m26=_ema(sl,26);
    if(m12!==null&&m26!==null)lines.push(m12-m26);
  }
  if(lines.length<9)return null;
  const sig=_ema(lines,9);
  if(sig===null)return null;
  const line=lines.at(-1);
  const hist=line-sig;
  // Prev hist
  let prevHist=null;
  if(lines.length>=2){
    const prevLines=lines.slice(0,-1);
    const prevSig=_ema(prevLines,9);
    if(prevSig!==null)prevHist=prevLines.at(-1)-prevSig;
  }
  const bull=hist>0;
  const cross=prevHist!==null&&((prevHist<0&&hist>0)||(prevHist>0&&hist<0));
  return{line,signal:sig,hist,bull,cross};
}
function _atr(rows){
  if(!rows||rows.length<15)return null;
  const trs=[];
  for(let i=1;i<rows.length;i++)
    trs.push(Math.max(rows[i].h-rows[i].l,Math.abs(rows[i].h-rows[i-1].c),Math.abs(rows[i].l-rows[i-1].c)));
  return trs.length>=14?trs.slice(-14).reduce((a,b)=>a+b,0)/14:null;
}
function _adr(rows){
  if(!rows||rows.length<14)return null;
  const r=rows.slice(-14);
  return{
    nom:r.reduce((a,b)=>a+(b.h-b.l),0)/14,
    pct:r.reduce((a,b)=>a+(b.h-b.l)/b.l,0)/14*100
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROCESS YAHOO RESULT â†’ STOCK OBJECT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function processYahoo(ticker,res){
  const meta=res.meta||{};
  const raw=res.indicators?.quote?.[0]||{};
  const ts=res.timestamp||[];
  const rows=[];
  for(let i=0;i<ts.length;i++){
    const c=raw.close?.[i],h=raw.high?.[i],l=raw.low?.[i],v=raw.volume?.[i];
    if(c!=null&&h!=null&&l!=null&&v!=null&&!isNaN(c)&&c>0&&h>0&&l>0)
      rows.push({c,h,l,v});
  }
  if(rows.length<30)return null;
  const closes=rows.map(x=>x.c), vols=rows.map(x=>x.v);
  const last=closes.at(-1), prev=closes.at(-2)??last;
  const pct=((last-prev)/prev)*100;

  const e3=_ema(closes,3),e5=_ema(closes,5),e10=_ema(closes,10),e20=_ema(closes,20);
  const s50=_sma(closes,50),s100=_sma(closes,100),s200=_sma(closes,200);
  const rsiV=_rsi(closes), srsiV=_stochRSI(closes);
  const macdV=_macd(closes);
  const atrV=_atr(rows), adrV=_adr(rows);

  const lastVol=vols.at(-1)??0;
  const lastValue=lastVol*last;
  const pct1today=lastValue*0.01;
  const vm3=_sma(vols,3),vm5=_sma(vols,5),vm20=_sma(vols,20),vm50=_sma(vols,50);

  const ms={
    ema3:e3!==null&&last>e3, ema5:e5!==null&&last>e5,
    ema10:e10!==null&&last>e10, ema20:e20!==null&&last>e20,
    sma50:s50!==null&&last>s50, sma100:s100!==null&&last>s100, sma200:s200!==null&&last>s200,
    vma3:vm3!==null&&lastVol>vm3, vma5:vm5!==null&&lastVol>vm5,
    vma20:vm20!==null&&lastVol>vm20, vma50:vm50!==null&&lastVol>vm50,
  };
  const above4=ms.ema3&&ms.ema5&&ms.ema10&&ms.ema20;
  let bull=0,bear=0;
  ['ema3','ema5','ema10','ema20','sma50','sma100','sma200'].forEach(k=>{if(ms[k])bull++;else bear++;});
  if(rsiV!==null){if(rsiV>50)bull++;else bear++;}
  if(srsiV!==null){if(srsiV>50)bull++;else bear++;}
  if(macdV){if(macdV.bull)bull++;else bear++;}

  const company=(meta.longName||meta.shortName||'').replace(/\s*\([^)]*\)\s*/g,'').trim()||ticker;

  return{
    ticker,company,price:last,pct,
    maStatus:ms,above4,bull,bear,
    rsi:rsiV,stochRsi:srsiV,
    macdBull:macdV?.bull??null, macdHist:macdV?.hist??null, macdCross:macdV?.cross??false,
    atrV,adrPct:adrV?.pct??null,adrNom:adrV?.nom??null,
    lastVol,vm20,lastValue,pct1today,
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA LOADING (GitHub â†’ cache fallback)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('load',async()=>{
  // Try GitHub JSON first
  try{
    dLog('Loading from GitHub repoâ€¦');
    const url=DATA_URL+'?_='+Date.now();
    const res=await fetch(url);
    if(res.ok){
      const j=await res.json();
      if(j?.data?.length>0){
        // Cache it
        try{localStorage.setItem(SK,JSON.stringify(j.data));localStorage.setItem(SKT,j.fetchedAt||Date.now())}catch(_){}
        _loadData(j.data, new Date(j.fetchedAt||Date.now()).getTime(), 'gh', j.fetchedAtWIB||'â€”');
        dLog(`GitHub OK: ${j.data.length} saham`,'ok');
        return;
      }
    }
  }catch(e){dLog('GitHub gagal: '+e.message,'warn')}

  // Fallback: localStorage cache
  try{
    const raw=localStorage.getItem(SK), ts=localStorage.getItem(SKT);
    if(raw){
      const data=JSON.parse(raw);
      if(data?.length>0){
        _loadData(data, ts?parseInt(ts):Date.now(), 'cache');
        dLog(`Cache loaded: ${data.length} saham`,'ok');
        return;
      }
    }
  }catch(e){dLog('Cache error: '+e.message,'err')}

  setDot('');
  document.getElementById('sText').textContent='Data belum tersedia';
  dLog('Tidak ada data');
});

function _loadData(data,ts,src,ghLabel){
  AD=data;
  const srcMap={gh:'ğŸ“¦ GitHub',cache:'ğŸ’¾ Cache'};
  const badge=`<span class="src-tag ${src}">${srcMap[src]||src}</span>`;
  document.getElementById('sText').textContent=`${AD.length} saham`;
  document.getElementById('tsWrap').style.display='flex';
  document.getElementById('tsText').textContent=src==='gh'?`Update: ${ghLabel}`:`Cache: ${_ago(ts)}`;
  document.getElementById('srcWrap').style.display='flex';
  document.getElementById('srcBadge').innerHTML=badge;
  document.getElementById('statsBar').style.display='flex';
  document.getElementById('s-src').style.display='inline-flex';
  document.getElementById('s-src').innerHTML=badge;
  setDot('ok');
  _updateStats();applyF();renderT();
  toast(`${AD.length} saham dimuat (${srcMap[src]||src})`,'in');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH (live, with clear button)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('sInp').addEventListener('input',function(){
  document.getElementById('sClear').classList.toggle('show',this.value.length>0);
  applyF(); renderT();
});
function clearSearch(){
  document.getElementById('sInp').value='';
  document.getElementById('sClear').classList.remove('show');
  applyF(); renderT();
  document.getElementById('sInp').focus();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleMF(k){maF.has(k)?maF.delete(k):maF.add(k);document.getElementById('mf-'+k).classList.toggle('on',maF.has(k));applyF();renderT()}
function resetMF(){maF.clear();['ema3','ema5','ema10','ema20','sma50','sma100','sma200'].forEach(k=>document.getElementById('mf-'+k).classList.remove('on'));applyF();renderT()}
function toggleVF(k){volF.has(k)?volF.delete(k):volF.add(k);document.getElementById('vf-'+k).classList.toggle('on',volF.has(k));applyF();renderT()}
function resetVF(){volF.clear();['vma3','vma5','vma20','vma50'].forEach(k=>document.getElementById('vf-'+k).classList.remove('on'));applyF();renderT()}
function toggleOF(k){oscF.has(k)?oscF.delete(k):oscF.add(k);document.getElementById('of-'+k).classList.toggle('on',oscF.has(k));applyF();renderT()}
function resetOF(){oscF.clear();['rsi-ob','rsi-os','rsi-bull','srsi-ob','srsi-os','macd-bull','macd-bear'].forEach(k=>document.getElementById('of-'+k).classList.remove('on'));applyF();renderT()}

function applyF(){
  const q=document.getElementById('sInp').value.trim().toUpperCase();
  let d=[...AD];
  if(q)d=d.filter(x=>x.ticker.includes(q)||(x.company||'').toUpperCase().includes(q));
  maF.forEach(k=>{d=d.filter(x=>x.maStatus?.[k]===true)});
  volF.forEach(k=>{d=d.filter(x=>x.maStatus?.[k]===true)});
  // Oscillator filters
  if(oscF.has('rsi-ob'))   d=d.filter(x=>x.rsi!=null&&x.rsi>70);
  if(oscF.has('rsi-os'))   d=d.filter(x=>x.rsi!=null&&x.rsi<30);
  if(oscF.has('rsi-bull')) d=d.filter(x=>x.rsi!=null&&x.rsi>50);
  if(oscF.has('srsi-ob'))  d=d.filter(x=>x.stochRsi!=null&&x.stochRsi>80);
  if(oscF.has('srsi-os'))  d=d.filter(x=>x.stochRsi!=null&&x.stochRsi<20);
  if(oscF.has('macd-bull'))d=d.filter(x=>x.macdBull===true);
  if(oscF.has('macd-bear'))d=d.filter(x=>x.macdBull===false);

  d.sort((a,b)=>{
    let va=a[sCol]??-Infinity, vb=b[sCol]??-Infinity;
    if(sCol==='ticker'){va=a.ticker||'';vb=b.ticker||'';return va.localeCompare(vb)*sDir}
    return(va-vb)*sDir;
  });
  DD=d;
  document.getElementById('s-sho').textContent=d.length;
}
function sortBy(c){
  const th=event.currentTarget;
  if(sCol===c)sDir*=-1;else{sCol=c;sDir=-1}
  document.querySelectorAll('tr.col-row th').forEach(t=>t.classList.remove('sa','sd'));
  th.classList.add(sDir===1?'sa':'sd');
  applyF();renderT();
}
function _updateStats(){
  document.getElementById('s-tot').textContent=AD.length;
  document.getElementById('s-bul').textContent=AD.filter(x=>x.bull>x.bear).length;
  document.getElementById('s-bea').textContent=AD.filter(x=>x.bear>x.bull).length;
  document.getElementById('s-abo').textContent=AD.filter(x=>x.above4).length;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
// Format numbers: Rb = ribu, Jt = juta, M = miliar, T = triliun
function _fmt(n){
  if(n==null||isNaN(n)||n===0)return'â€”';
  const abs=Math.abs(n);
  if(abs>=1e12)return(n/1e12).toFixed(2)+' T';
  if(abs>=1e9) return(n/1e9).toFixed(2)+' M';
  if(abs>=1e6) return(n/1e6).toFixed(1)+' Jt';
  if(abs>=1e3) return(n/1e3).toFixed(1)+' Rb';
  return n.toFixed(0);
}
function _price(n){
  if(n==null||isNaN(n))return'â€”';
  if(n>=1000)return Math.round(n).toLocaleString('id-ID');
  return n.toFixed(n>=10?0:2);
}
function _pct(n){if(n==null||isNaN(n))return'â€”';return(n>=0?'+':'')+n.toFixed(2)+'%'}
function _dec(n,d=1){if(n==null||isNaN(n))return'â€”';return n.toFixed(d)}
function _rsiColor(v){
  if(v==null)return'var(--text3)';
  if(v>70)return'var(--red)';
  if(v<30)return'var(--green)';
  if(v>55)return'var(--green)';
  if(v<45)return'var(--red)';
  return'var(--text2)';
}

const MA_KEYS =['ema3','ema5','ema10','ema20','sma50','sma100','sma200'];
const MA_LBLS =['E3','E5','E10','E20','S50','S1','S2'];
const VOL_KEYS=['vma3','vma5','vma20','vma50'];
const VOL_LBLS=['V3','V5','V20','V50'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderT(){
  const tb=document.getElementById('tBody');
  if(!DD.length){
    tb.innerHTML=`<tr><td colspan="14"><div class="t-empty"><div class="ico">âˆ…</div>Tidak ada data sesuai filter</div></td></tr>`;
    return;
  }

  tb.innerHTML=DD.map((d,i)=>{
    const tvUrl=`https://www.tradingview.com/chart/?symbol=IDX%3A${d.ticker}`;

    // MA pips
    const maPips=MA_KEYS.map((k,ki)=>{
      const v=d.maStatus?.[k];
      const cls=v===true?'on-g':v===false?'off-r':'na';
      return`<span class="pip ${cls}" title="${k.toUpperCase()}">${MA_LBLS[ki]}</span>`;
    }).join('');

    // Vol pips
    const vPips=VOL_KEYS.map((k,ki)=>{
      const v=d.maStatus?.[k];
      const cls=v===true?'on-b':v===false?'off-r':'na';
      return`<span class="pip ${cls}" title="Vol vs ${k.toUpperCase()}">${VOL_LBLS[ki]}</span>`;
    }).join('');

    // RSI gauge
    const rCv=_rsiColor(d.rsi), sCv=_rsiColor(d.stochRsi);
    const rP=d.rsi!=null?Math.min(100,Math.max(0,d.rsi)):0;
    const sP=d.stochRsi!=null?Math.min(100,Math.max(0,d.stochRsi)):0;

    // MACD badge
    let macdHtml='<span class="macd-badge macd-neu">N/A</span>';
    if(d.macdBull!==null){
      const cls=d.macdBull?'macd-bull':'macd-bear';
      const lbl=d.macdBull?'â–² Bull':'â–¼ Bear';
      const cross=d.macdCross?'âœ¦ ':'';
      macdHtml=`<span class="macd-badge ${cls}" title="Histogram: ${d.macdHist!=null?d.macdHist.toFixed(2):'â€”'}">${cross}${lbl}</span>`;
    }

    // Bull/bear bar
    const bTotal=d.bull+d.bear||1;
    const bPct=Math.round(d.bull/bTotal*100);
    const bullCls=d.bull>d.bear?'up':d.bull<d.bear?'dn':'nu';

    // ADR
    const adrCls=d.adrPct!=null?(d.adrPct>4?'up':d.adrPct<1.5?'nu':''):'';

    const pU=d.pct>=0;

    return`<tr>
<td class="c-no">${i+1}</td>
<td>
  <div class="c-tk"><a href="${tvUrl}" target="_blank" rel="noopener">${d.ticker}</a></div>
  <div class="c-co" title="${d.company||''}">${d.company||'â€”'}</div>
</td>
<td class="bd-price c-num lg">${_price(d.price)}</td>
<td class="bd-price c-num ${pU?'up':'dn'}">${_pct(d.pct)}</td>
<td class="bd-price c-num" style="color:var(--accent)">${_fmt(d.pct1today)}</td>
<td class="bd-ma"><div class="pips">${maPips}</div></td>
<td class="bd-ma">
  <div class="gauge">
    <div class="g-track"><div class="g-fill" style="width:${bPct}%;background:var(--green)"></div></div>
    <span class="g-val ${bullCls}">${d.bull}â†‘ ${d.bear}â†“</span>
  </div>
</td>
<td class="bd-vol"><div class="pips">${vPips}</div></td>
<td class="bd-vol c-num">${_fmt(d.lastValue)}</td>
<td class="bd-osc">
  <div class="gauge">
    <div class="g-track"><div class="g-fill" style="width:${rP}%;background:${rCv}"></div></div>
    <span class="g-val" style="color:${rCv}">${_dec(d.rsi)}</span>
  </div>
</td>
<td class="bd-osc">
  <div class="gauge">
    <div class="g-track"><div class="g-fill" style="width:${sP}%;background:${sCv}"></div></div>
    <span class="g-val" style="color:${sCv}">${_dec(d.stochRsi)}</span>
  </div>
</td>
<td class="bd-osc">${macdHtml}</td>
<td class="bd-osc c-num">${_dec(d.atrV,1)}</td>
<td class="bd-osc">
  <div class="adr-wrap">
    <div class="adr-pct ${adrCls}">${_dec(d.adrPct,2)}%</div>
    <div class="adr-nom">${_fmt(d.adrNom)}</div>
  </div>
</td>
</tr>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setDot(s){
  const d=document.getElementById('sDot');
  d.className='dot';
  if(s==='ok')d.classList.add('ok');
  if(s==='spin')d.classList.add('spin');
}
function _ago(ts){
  const d=Date.now()-ts, h=Math.floor(d/3600000), m=Math.floor((d%3600000)/60000);
  if(h>=24)return Math.floor(h/24)+'h lalu';
  if(h>0)return h+'j '+m+'m lalu';
  return m+'m lalu';
}
function toast(m,t='in'){
  const el=document.createElement('div');
  el.className=`toast ${t}`;
  el.textContent=m;
  document.getElementById('toasts').appendChild(el);
  requestAnimationFrame(()=>requestAnimationFrame(()=>el.classList.add('show')));
  setTimeout(()=>{el.classList.remove('show');setTimeout(()=>el.remove(),350)},3200);
}
</script>
</body>
</html>
